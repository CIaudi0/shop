#!/bin/bash
set -e

# Rimuove un eventuale server.pid rimasto bloccato (server crashato in precedenza)
if [ -f tmp/pids/server.pid ]; then
  rm tmp/pids/server.pid
fi

# Se il comando passato Ã¨ il server rails...
if [ "${1}" == "./bin/rails" ] && [ "${2}" == "server" ]; then
  echo "--- Preparing database ---"
  # Crea il DB e lancia le migrazioni se non esistono (idempotente)
  ./bin/rails db:prepare
fi

# Esegue il comando principale (es. rails server)
exec "${@}"