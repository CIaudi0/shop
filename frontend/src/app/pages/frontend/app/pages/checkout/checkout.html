<div class="checkout-container">
  <h2>Checkout</h2>

  @if (orderSuccess) {
    <div class="success-message">
      <h3>Grazie! Il tuo ordine è stato ricevuto.</h3>
    </div>
  } @else {
    
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      
      <div formGroupName="customer">
        <h3>Dati Cliente</h3>
        
        <mat-form-field appearance="fill">
          <mat-label>Nome</mat-label>
          <input matInput formControlName="firstName">
          @if (hasError('customer.firstName','required')) {
            <mat-error>
              Il nome è obbligatorio.
            </mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Cognome</mat-label>
          <input matInput formControlName="lastName">
           @if (hasError('customer.lastName','required')) {
            <mat-error>Il cognome è obbligatorio.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email">
           @if (hasError('customer.email','required')) {
            <mat-error>L'email è obbligatoria.</mat-error>
          }
           @if (hasError('customer.email','email')) {
            <mat-error>Email non valida.</mat-error>
          }
        </mat-form-field>
      </div>

      <div formGroupName="address">
        <h3>Indirizzo di Spedizione</h3>
        
        <mat-form-field appearance="fill">
          <mat-label>Via</mat-label>
          <input matInput formControlName="street">
          @if (hasError('address.street','required')) {
            <mat-error>La via è obbligatoria.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Città</mat-label>
          <input matInput formControlName="city">
          @if (hasError('address.city','required')) {
            <mat-error>La città è obbligatoria.</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>CAP</mat-label>
          <input matInput formControlName="zip">
          @if (hasError('address.zip','required')) {
            <mat-error>Il CAP è obbligatorio.</mat-error>
          }
        </mat-form-field>
      </div>

      @if (showSummary && form.invalid) {
        <p class="error-summary">Per favore compila tutti i campi obbligatori.</p>
      }

      @if (orderError) {
        <p class="error-summary">Errore durante l'invio dell'ordine. Riprova.</p>
      }

      <div class="actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="loading">
          {{ loading ? 'Invio in corso...' : 'Conferma Ordine' }}
        </button>
      </div>

    </form>
  }
</div>